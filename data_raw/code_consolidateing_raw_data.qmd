---
title: "Consolidating_raw_data"
format: html
editor: visual
---

```{r}

library(tidyverse)
library(phenofit)

```

# loading denver_tree_data

```{r}

st_drop_geometry(st_read("./denver_tree/denver_trees_sample.geojson")) %>% 
  mutate(UID = row_number()) %>% 
  left_join(read_rds("./landcover/cleaned_data/land_cover.rds"), 
            by = "UID") -> tree_ldc

read_rds("./ndvi/pheno_curve_metrics/extracted_metrics.rds") %>% 
  mutate(UID = as.integer(UID)) %>% 
  left_join(tree_ldc, by = "UID") -> tree_ldc_metrics

tree_ldc_metrics %>% 
  group_by(botanic_common, leaf_persistence) %>% 
  summarize(n = length(unique(UID)))

tree_ldc_metrics

```

```{r}

source("../R/evaluate_pheno_methods.R")

read_rds("./ndvi/raw_extracts/extracted_ndvi_value.rds") -> extracts

pheno_curves <- c("Elmore")
season_curves <- c("wWHIT")

# Test with 100 random trees

usability_matrix <- evaluate_pheno_methods(
  extracts = extracts,
  n_samples = 100,
  pheno_curves = pheno_curves,
  season_curves = season_curves,
  min_observations = 6,
  min_r2 = 0.9
  )
 
usability_matrix

```

